# i18n Guide (en / zh-CN / ja-JP)

The app uses `next-intl` with locale-prefixed routes and cookie persistence. All messages live under `src/i18n/` and follow a single `common.json` per locale.

## Files
- `src/i18n/index.ts` — locale constants (`SUPPORTED_LOCALES`, `DEFAULT_LOCALE`), fallback helpers, direction helpers.
- `src/i18n/request.ts` — Next.js request config for `next-intl`.
- `src/i18n/locales/<locale>/common.json` — translation resources.
- `src/components/LanguageSwitcher.tsx` — UI and cookie persistence for locale changes.
- `src/utils/navigation.ts` — builds locale-aware URLs.

## Key conventions
- Semantic, dotted, and scoped by feature/page:
  - `page.home.title`, `page.project.gallery`, `nav.language`
  - `form.project.title`, `form.project.images.helper`, `idea.form.missingTitle`
  - `error.project.notFound`, `error.event.createFailed`
- Reuse shared keys instead of duplicating strings in multiple namespaces.
- Keep the same key set across all locales; avoid locale-specific keys.

## Add a new message
1. Pick a namespace (page/feature/component): e.g., `idea.detail.images` or `event.list.placeholder`.
2. Add the key/value to **each** `src/i18n/locales/<locale>/common.json`.
3. Use it via `useTranslations('<namespace>')` (client) or `getTranslations('<namespace>')` (server).

## Add a new language
1. Copy an existing locale folder: `src/i18n/locales/en` → `src/i18n/locales/<locale-code>` and translate all values.
2. Append the locale code to `SUPPORTED_LOCALES` and `LOCALE_LABELS` in `src/i18n/index.ts`.
3. Update `matcher` in `src/middleware.ts` to include the locale in the path pattern.
4. (Optional) add to `RTL_LOCALES` in `src/i18n/index.ts` if the language is right-to-left.

## Error messages
- Server responses use error codes (e.g., `PROJECT.NOT_FOUND`, `EVENT.CREATE_FAILED`).
- `src/utils/errorCodes.ts` maps codes to translation keys (e.g., `error.project.notFound`).
- UI components resolve user-facing text through those keys; do not hard-code error strings in components.

## Date/number formatting
- Use `formatDate(value, locale)` and `formatNumber(value, locale)` from `src/utils/format.ts` to stay locale-aware.

## Locale persistence
- Language switcher writes cookie `NEXT_LOCALE` and pushes a locale-prefixed route via `buildLocalizedPath`, ensuring instant UI updates without full reloads.
